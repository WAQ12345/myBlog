import{_ as i,c as a,o as e,ag as n}from"./chunks/framework.B-vhMDQ8.js";const k=JSON.parse('{"title":"Claude Code Setup (macOS)","description":"","frontmatter":{},"headers":[],"relativePath":"notes/tools/claude/setup.md","filePath":"notes/tools/claude/setup.md"}'),t={name:"notes/tools/claude/setup.md"};function l(o,s,d,p,h,r){return e(),a("div",null,[...s[0]||(s[0]=[n(`<h1 id="claude-code-setup-macos" tabindex="-1">Claude Code Setup (macOS) <a class="header-anchor" href="#claude-code-setup-macos" aria-label="Permalink to &quot;Claude Code Setup (macOS)&quot;">​</a></h1><p>npm 安装、代理配置与首次启动。</p><hr><h2 id="_1-环境" tabindex="-1">1. 环境 <a class="header-anchor" href="#_1-环境" aria-label="Permalink to &quot;1. 环境&quot;">​</a></h2><ul><li>macOS；Node.js 18+；<code>npm install -g @anthropic-ai/claude-code</code></li></ul><h2 id="_2-安装与验证" tabindex="-1">2. 安装与验证 <a class="header-anchor" href="#_2-安装与验证" aria-label="Permalink to &quot;2. 安装与验证&quot;">​</a></h2><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -g</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @anthropic-ai/claude-code</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">claude</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --version</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>若 <code>command not found</code>：在 <code>~/.zshrc</code> 加 <code>export PATH=&quot;$(npm config get prefix)/bin:$PATH&quot;</code>，再 <code>source ~/.zshrc</code>。</p><h2 id="_3-代理-无法直连时" tabindex="-1">3. 代理（无法直连时） <a class="header-anchor" href="#_3-代理-无法直连时" aria-label="Permalink to &quot;3. 代理（无法直连时）&quot;">​</a></h2><p>在 <code>~/.zshrc</code> 末尾加（端口改为你的）：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">alias</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> claude-proxy</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;HTTP_PROXY=http://127.0.0.1:7890 HTTPS_PROXY=http://127.0.0.1:7890 claude&#39;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>执行 <code>source ~/.zshrc</code>。<strong>若配置了代理，启动、登录与日常使用都必须用 <code>claude-proxy</code>，不要用 <code>claude</code>。</strong></p><h3 id="_3-1-windows-代理-批处理方式" tabindex="-1">3.1 Windows 代理（批处理方式） <a class="header-anchor" href="#_3-1-windows-代理-批处理方式" aria-label="Permalink to &quot;3.1 Windows 代理（批处理方式）&quot;">​</a></h3><p>当 PowerShell 中通过函数设置环境变量再调用 <code>claude</code> 时，子进程可能拿不到代理变量，出现 <code>ERR_BAD_REQUEST</code> 或 <code>Unable to connect to Anthropic services</code>。可改用 CMD 批处理方式，在启动前设置好环境变量再调用 <code>claude</code>。</p><p><strong>步骤：</strong></p><ol><li>新建文本文件，命名为 <code>claude-proxy.cmd</code>，放在常用目录（如 <code>D:\\Tools</code> 或用户目录）。</li><li>用记事本打开，写入以下内容（<strong>将 <code>7890</code> 改为你的 HTTP 代理端口</strong>）：</li></ol><div class="language-batch vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">batch</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@echo</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> off</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> HTTP_PROXY</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">http://127.0.0.1:7890</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> HTTPS_PROXY</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">http://127.0.0.1:7890</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> http_proxy</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">http://127.0.0.1:7890</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> https_proxy</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">http://127.0.0.1:7890</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">claude </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">%*</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ol start="3"><li>保存。使用时在 <strong>CMD</strong> 中先 <code>cd</code> 到该目录，执行 <code>claude-proxy.cmd</code>；或将该目录加入系统 PATH 后直接执行 <code>claude-proxy</code>。</li><li><strong>注意</strong>：Claude Code 仅支持 HTTP/HTTPS 代理，不支持 SOCKS。若使用 Clash，请确认使用 HTTP 代理端口（如 7890），不要用 SOCKS 端口（如 7891）。</li></ol><h3 id="_3-2-windows-代理-仅-claude-生效-推荐" tabindex="-1">3.2 Windows 代理（仅 Claude 生效，推荐） <a class="header-anchor" href="#_3-2-windows-代理-仅-claude-生效-推荐" aria-label="Permalink to &quot;3.2 Windows 代理（仅 Claude 生效，推荐）&quot;">​</a></h3><p>若希望<strong>只让 Claude Code 走代理，不影响 npm、浏览器等其他软件</strong>，可在 Claude Code 的用户配置里设置代理，不设系统环境变量。</p><p><strong>步骤：</strong></p><ol><li>打开或创建 <code>%USERPROFILE%\\.claude\\settings.json</code>（如 <code>C:\\Users\\你的用户名\\.claude\\settings.json</code>）。</li><li>写入以下内容（将 <code>7890</code> 改为你的 HTTP 代理端口）；若文件已有其他配置，只增加或合并 <code>env</code> 块即可：</li></ol><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;env&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;HTTP_PROXY&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;http://127.0.0.1:7890&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;HTTPS_PROXY&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;http://127.0.0.1:7890&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;http_proxy&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;http://127.0.0.1:7890&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;https_proxy&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;http://127.0.0.1:7890&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ol start="3"><li>保存。之后直接运行 <code>claude</code> 即可走代理，<strong>仅 Claude Code 会读取该配置</strong>，其他程序不受影响。</li></ol><h3 id="_3-3-windows-代理-用户环境变量-全局" tabindex="-1">3.3 Windows 代理（用户环境变量，全局） <a class="header-anchor" href="#_3-3-windows-代理-用户环境变量-全局" aria-label="Permalink to &quot;3.3 Windows 代理（用户环境变量，全局）&quot;">​</a></h3><p>若希望任意目录下直接运行 <code>claude</code> 即走代理，且不介意<strong>本机其他使用 HTTP_PROXY 的程序（如 npm、curl）也走该代理</strong>，可将代理设为当前用户的永久环境变量。</p><p><strong>方式 A：PowerShell 一条命令</strong></p><p>在 PowerShell 中执行（将 <code>7890</code> 改为你的 HTTP 代理端口）：</p><div class="language-powershell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Environment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]::SetEnvironmentVariable(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;HTTP_PROXY&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;http://127.0.0.1:7890&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;User&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Environment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]::SetEnvironmentVariable(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;HTTPS_PROXY&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;http://127.0.0.1:7890&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;User&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Environment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]::SetEnvironmentVariable(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;http_proxy&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;http://127.0.0.1:7890&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;User&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Environment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]::SetEnvironmentVariable(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;https_proxy&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;http://127.0.0.1:7890&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;User&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>方式 B：图形界面</strong></p><ol><li>Win + R → 输入 <code>sysdm.cpl</code> → 回车 →「高级」→「环境变量」。</li><li>在「用户变量」中「新建」：变量名 <code>HTTP_PROXY</code>，变量值 <code>http://127.0.0.1:7890</code>；再新建 <code>HTTPS_PROXY</code>、<code>http_proxy</code>、<code>https_proxy</code>，值同上。</li><li>确定保存。</li></ol><p><strong>生效与注意：</strong></p><ul><li>设置后关闭所有已打开的终端，重新打开后再执行 <code>claude</code> 即可走代理。</li><li><strong>该方式会影响本机所有读取上述环境变量的程序</strong>；若只想让 Claude 走代理，请用 3.2（settings.json）。</li></ul><h2 id="_4-登录" tabindex="-1">4. 登录 <a class="header-anchor" href="#_4-登录" aria-label="Permalink to &quot;4. 登录&quot;">​</a></h2><p>首次运行选登录方式（Claude 订阅 / Console API / 第三方）。若报 403，用 <code>claude-proxy</code> 启动后再 <code>/login</code>。</p><h2 id="_5-后续使用" tabindex="-1">5. 后续使用 <a class="header-anchor" href="#_5-后续使用" aria-label="Permalink to &quot;5. 后续使用&quot;">​</a></h2><ul><li>需代理：<code>claude-proxy</code>；不需代理：<code>claude</code></li><li><code>claude doctor</code>、<code>claude config</code>（需代理时先用 <code>claude-proxy</code> 启动）</li></ul><h2 id="_6-常见问题" tabindex="-1">6. 常见问题 <a class="header-anchor" href="#_6-常见问题" aria-label="Permalink to &quot;6. 常见问题&quot;">​</a></h2><table tabindex="0"><thead><tr><th>现象</th><th>处理</th></tr></thead><tbody><tr><td>command not found</td><td>PATH 加 npm global bin，<code>source ~/.zshrc</code></td></tr><tr><td>改完 .zshrc 不生效</td><td>当前终端执行 <code>source ~/.zshrc</code> 或新开终端</td></tr><tr><td>403 / Please run /login</td><td>用 <code>claude-proxy</code> 启动，再 <code>/login</code>；代理环境下必须用 <code>claude-proxy</code></td></tr><tr><td>403 已登录仍报 Request not allowed</td><td>每次启动都用 <code>claude-proxy.cmd</code>（需代理时）；在对话内再执行 <code>/login</code> 刷新；见下方 6.1</td></tr><tr><td>安装脚本返回 HTML</td><td>地区限制，用 npm 安装</td></tr><tr><td>Windows：ERR_BAD_REQUEST / Unable to connect</td><td>用批处理方式（见 3.1）；确认代理为 HTTP 且端口正确</td></tr></tbody></table><h3 id="_6-1-403-已登录仍报-request-not-allowed" tabindex="-1">6.1 403 已登录仍报 Request not allowed <a class="header-anchor" href="#_6-1-403-已登录仍报-request-not-allowed" aria-label="Permalink to &quot;6.1 403 已登录仍报 Request not allowed&quot;">​</a></h3><p>多为<strong>代理不一致</strong>：登录时走了代理，但日常请求未走代理（或反之），服务端返回 403，客户端提示「请运行 /login」。</p><p><strong>处理顺序：</strong></p><ol><li><strong>需代理时，每次启动都用同一方式</strong>：只用 <code>claude-proxy.cmd</code> 启动 Claude Code，不要混用「直接运行 <code>claude</code>」和「批处理」。确保进程一启动就带上 <code>HTTP_PROXY</code>/<code>HTTPS_PROXY</code>。</li><li><strong>在对话内再执行一次 <code>/login</code></strong>：在已用 <code>claude-proxy.cmd</code> 启动的会话里输入 <code>/login</code>，按提示完成登录/刷新，让后续请求都带正确认证且走代理。</li><li><strong>仍 403 时</strong>：完全退出 Claude Code，确认代理软件已开启且端口正确，仅用 <code>claude-proxy.cmd</code> 启动，进入后先执行 <code>/login</code>，再正常使用。</li><li><strong>确认订阅与区域</strong>：账号需有 Claude Code 权限；若所在地区受限，必须全程使用代理访问 api.anthropic.com。</li></ol>`,43)])])}const u=i(t,[["render",l]]);export{k as __pageData,u as default};
