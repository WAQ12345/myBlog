<!DOCTYPE html>
<html lang="zh-CN" dir="ltr">
  <head>
    <meta charset="utf-8">
    
    <title>坐标系处理完整指南 | 个人博客</title>
    
    <meta name="generator" content="VitePress v1.6.4">
    <link rel="preload stylesheet" href="/myBlog/assets/style.BvoprRI1.css" as="style">
    <link rel="preload stylesheet" href="/myBlog/vp-icons.css" as="style">
    
    <script type="module" src="/myBlog/assets/app.Ds-bA2YP.js"></script>
    <link rel="preload" href="/myBlog/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/myBlog/assets/chunks/theme.YT8lrNJz.js">
    <link rel="modulepreload" href="/myBlog/assets/chunks/framework.B-vhMDQ8.js">
    <link rel="modulepreload" href="/myBlog/assets/notes_frontend-basics_coordinate-system-guide.md.B1zDyquL.lean.js">
    <link rel="icon" href="/myBlog/me.jpg">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="QA的个人博客 - 学习笔记、技术分享、个人简历">
    <meta name="keywords" content="前端开发,学习笔记,技术博客,个人简历">
    <script>var _hmt=_hmt||[];(function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?2c209de3250aed0ad39b4df3cc025494";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)})();</script>
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-5d98c3a5><!--[--><!--]--><!--[--><span tabindex="-1" data-v-0b0ada53></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-0b0ada53>Skip to content</a><!--]--><!----><header class="VPNav" data-v-5d98c3a5 data-v-ae24b3ad><div class="VPNavBar" data-v-ae24b3ad data-v-6aa21345><div class="wrapper" data-v-6aa21345><div class="container" data-v-6aa21345><div class="title" data-v-6aa21345><div class="VPNavBarTitle has-sidebar" data-v-6aa21345 data-v-1168a8e4><a class="title" href="/myBlog/" data-v-1168a8e4><!--[--><!--]--><!--[--><img class="VPImage logo" src="/myBlog/me.jpg" alt data-v-8426fc1a><!--]--><span data-v-1168a8e4>个人博客</span><!--[--><!--]--></a></div></div><div class="content" data-v-6aa21345><div class="content-body" data-v-6aa21345><!--[--><!--]--><div class="VPNavBarSearch search" data-v-6aa21345><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-6aa21345 data-v-dc692963><span id="main-nav-aria-label" class="visually-hidden" data-v-dc692963> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/myBlog/" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>首页</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/myBlog/notes/" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>学习笔记</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/myBlog/resume/" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>个人简历</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/myBlog/projects/" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>项目作品</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-6aa21345 data-v-6c893767><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-6c893767 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-6aa21345 data-v-0394ad82 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://gitee.com/the-fields-are-dark" aria-label="gitee" target="_blank" rel="noopener" data-v-7bc22406 data-v-bd121fe5><span class="vpi-social-gitee"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-6aa21345 data-v-bb2aa2f0 data-v-cf11d7a2><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-cf11d7a2><span class="vpi-more-horizontal icon" data-v-cf11d7a2></span></button><div class="menu" data-v-cf11d7a2><div class="VPMenu" data-v-cf11d7a2 data-v-b98bc113><!----><!--[--><!--[--><!----><div class="group" data-v-bb2aa2f0><div class="item appearance" data-v-bb2aa2f0><p class="label" data-v-bb2aa2f0>Appearance</p><div class="appearance-action" data-v-bb2aa2f0><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-bb2aa2f0 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div></div></div><div class="group" data-v-bb2aa2f0><div class="item social-links" data-v-bb2aa2f0><div class="VPSocialLinks social-links-list" data-v-bb2aa2f0 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://gitee.com/the-fields-are-dark" aria-label="gitee" target="_blank" rel="noopener" data-v-7bc22406 data-v-bd121fe5><span class="vpi-social-gitee"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-6aa21345 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><div class="divider" data-v-6aa21345><div class="divider-line" data-v-6aa21345></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-5d98c3a5 data-v-a6f0e41e><div class="container" data-v-a6f0e41e><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-a6f0e41e><span class="vpi-align-left menu-icon" data-v-a6f0e41e></span><span class="menu-text" data-v-a6f0e41e>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-a6f0e41e data-v-8a42e2b4><button data-v-8a42e2b4>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-5d98c3a5 data-v-319d5ca6><div class="curtain" data-v-319d5ca6></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-319d5ca6><span class="visually-hidden" id="sidebar-aria-label" data-v-319d5ca6> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 is-link has-active" data-v-c40bc020 data-v-b3fd67f8><div class="item" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/myBlog/notes/" data-v-b3fd67f8><!--[--><h2 class="text" data-v-b3fd67f8>学习笔记</h2><!--]--></a><!----></div><div class="items" data-v-b3fd67f8><!--[--><section class="VPSidebarItem level-1 has-active" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h3 class="text" data-v-b3fd67f8>前端基础</h3><!----></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-2 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/myBlog/notes/frontend-basics/css-style-guide.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>CSS 规范文档</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/myBlog/notes/frontend-basics/coordinate-system-guide.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>坐标系处理完整指南</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/myBlog/notes/frontend-basics/browser-storage.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>浏览器存储知识</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h3 class="text" data-v-b3fd67f8>网络知识</h3><!----></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-2 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/myBlog/notes/network/" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>网络知识体系</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h3 class="text" data-v-b3fd67f8>项目实战</h3><!----></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-2 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/myBlog/notes/projects/3d-particle-interaction.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>3D 粒子交互系统</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h3 class="text" data-v-b3fd67f8>开发工具</h3><!----></div><div class="items" data-v-b3fd67f8><!--[--><section class="VPSidebarItem level-2" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h4 class="text" data-v-b3fd67f8>Cursor</h4><!----></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-3 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/myBlog/notes/tools/cursor/cursor-rules.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Cursor 开发规则</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-2" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h4 class="text" data-v-b3fd67f8>Claude Code</h4><!----></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-3 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/myBlog/notes/tools/claude/setup.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>安装与配置</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/myBlog/notes/tools/claude/config-claude-json.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>配置说明 (~/.claude.json)</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/myBlog/notes/tools/claude/mcp-and-proxy.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>MCP 与代理</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/myBlog/notes/tools/claude/skills-guide.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Skills 指南</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/myBlog/notes/tools/claude/dev-standards.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>开发规范</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-2" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h4 class="text" data-v-b3fd67f8>Qwen Code</h4><!----></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-3 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/myBlog/notes/tools/qwen/qwen-code.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Qwen Code 安装</p><!--]--></a><!----></div><!----></div><!--]--></div></section><!--]--></div></section><section class="VPSidebarItem level-1" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h3 class="text" data-v-b3fd67f8>网站部署</h3><!----></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-2 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/myBlog/notes/deployment/deployment-guide.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>GitHub Pages 部署</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/myBlog/notes/deployment/analytics.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>网站访问统计配置</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h3 class="text" data-v-b3fd67f8>外部开发</h3><!----></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-2 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/myBlog/notes/external-api/yuque-openapi-guide.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>语雀 OpenAPI 开发指南</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h3 class="text" data-v-b3fd67f8>工程化实践</h3><!----></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-2 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/myBlog/notes/engineering/frontend-engineering-guide.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>前端工程化实践指南</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/myBlog/notes/engineering/frontend-development-standards.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>前端开发规范</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/myBlog/notes/engineering/git-commit-convention.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Git 提交规范</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/myBlog/notes/engineering/vue-webcomponent-build-issues.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Vue WebComponent 构建问题</p><!--]--></a><!----></div><!----></div><!--]--></div></section><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-5d98c3a5 data-v-1428d186><div class="VPDoc has-sidebar has-aside" data-v-1428d186 data-v-39a288b8><!--[--><!--]--><div class="container" data-v-39a288b8><div class="aside" data-v-39a288b8><div class="aside-curtain" data-v-39a288b8></div><div class="aside-container" data-v-39a288b8><div class="aside-content" data-v-39a288b8><div class="VPDocAside" data-v-39a288b8 data-v-3f215769><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-3f215769 data-v-a5bbad30><div class="content" data-v-a5bbad30><div class="outline-marker" data-v-a5bbad30></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-a5bbad30>On this page</div><ul class="VPDocOutlineItem root" data-v-a5bbad30 data-v-b933a997><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-39a288b8><div class="content-container" data-v-39a288b8><!--[--><!--]--><main class="main" data-v-39a288b8><div style="position:relative;" class="vp-doc _myBlog_notes_frontend-basics_coordinate-system-guide" data-v-39a288b8><div><h1 id="坐标系处理完整指南" tabindex="-1">坐标系处理完整指南 <a class="header-anchor" href="#坐标系处理完整指南" aria-label="Permalink to &quot;坐标系处理完整指南&quot;">​</a></h1><h2 id="📚-目录" tabindex="-1">📚 目录 <a class="header-anchor" href="#📚-目录" aria-label="Permalink to &quot;📚 目录&quot;">​</a></h2><ol><li><a href="#坐标系基础概念">坐标系基础概念</a></li><li><a href="#常用地图-api-介绍">常用地图 API 介绍</a></li><li><a href="#统一坐标策略强烈推荐">统一坐标策略（强烈推荐）</a></li><li><a href="#项目中的坐标使用情况">项目中的坐标使用情况</a></li><li><a href="#工具函数使用说明">工具函数使用说明</a></li><li><a href="#实际应用示例">实际应用示例</a></li><li><a href="#最佳实践">最佳实践</a></li><li><a href="#常见问题">常见问题</a></li></ol><hr><h2 id="📖-坐标系基础概念" tabindex="-1">📖 坐标系基础概念 <a class="header-anchor" href="#📖-坐标系基础概念" aria-label="Permalink to &quot;📖 坐标系基础概念&quot;">​</a></h2><h3 id="什么是坐标系" tabindex="-1">什么是坐标系？ <a class="header-anchor" href="#什么是坐标系" aria-label="Permalink to &quot;什么是坐标系？&quot;">​</a></h3><p>坐标系是定义如何用数字（经纬度）来表示地球上位置的标准系统。不同的坐标系使用不同的加密或投影算法，导致相同的经纬度数值在不同坐标系下指向不同的实际位置。</p><h3 id="常见的坐标系类型" tabindex="-1">常见的坐标系类型 <a class="header-anchor" href="#常见的坐标系类型" aria-label="Permalink to &quot;常见的坐标系类型&quot;">​</a></h3><table tabindex="0"><thead><tr><th>坐标系</th><th>全称</th><th>使用场景</th><th>特点</th></tr></thead><tbody><tr><td><strong>WGS84</strong></td><td>World Geodetic System 1984</td><td>GPS 设备、国际标准</td><td>全球通用的原始坐标，无加密</td></tr><tr><td><strong>GCJ-02</strong></td><td>国测局坐标系/火星坐标系</td><td>高德地图、腾讯地图</td><td>中国国家测绘局加密，偏移约 50-100 米</td></tr><tr><td><strong>BD-09</strong></td><td>百度坐标系</td><td>百度地图</td><td>在 GCJ-02 基础上二次加密，偏移约 100-300 米</td></tr></tbody></table><h3 id="坐标系之间的关系" tabindex="-1">坐标系之间的关系 <a class="header-anchor" href="#坐标系之间的关系" aria-label="Permalink to &quot;坐标系之间的关系&quot;">​</a></h3><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>WGS84 (GPS原始坐标)</span></span>
<span class="line"><span>    ↓ 加密偏移</span></span>
<span class="line"><span>GCJ-02 (火星坐标/高德地图)</span></span>
<span class="line"><span>    ↓ 再次加密偏移</span></span>
<span class="line"><span>BD-09 (百度地图)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="⚠️-核心问题-相同数字-相同位置" tabindex="-1">⚠️ 核心问题：相同数字 ≠ 相同位置 <a class="header-anchor" href="#⚠️-核心问题-相同数字-相同位置" aria-label="Permalink to &quot;⚠️ 核心问题：相同数字 ≠ 相同位置&quot;">​</a></h3><p><strong>关键理解</strong>：同一个经纬度数值（如 <code>32.060255, 118.796877</code>）在不同的坐标系下，代表的是<strong>完全不同的地理位置</strong>！</p><p><strong>示例</strong>：</p><ul><li><code>32.060255, 118.796877</code> 在 <strong>WGS84</strong> 下 = GPS 设备的实际位置</li><li><code>32.060255, 118.796877</code> 在 <strong>BD-09</strong> 下 = 百度地图上的另一个位置</li><li>两者在现实中可能相差 <strong>100-300 米</strong>！</li></ul><h3 id="为什么会有偏差" tabindex="-1">为什么会有偏差？ <a class="header-anchor" href="#为什么会有偏差" aria-label="Permalink to &quot;为什么会有偏差？&quot;">​</a></h3><ol><li><strong>加密保护</strong>：中国境内的地图服务使用加密坐标系（GCJ-02、BD-09），而非国际标准 WGS84</li><li><strong>精度要求</strong>：不同的转换算法会产生不同程度的偏移</li><li><strong>视觉偏差</strong>：在百度地图上显示非 BD-09 坐标时，会产生明显的偏移</li></ol><h3 id="偏差范围参考" tabindex="-1">偏差范围参考 <a class="header-anchor" href="#偏差范围参考" aria-label="Permalink to &quot;偏差范围参考&quot;">​</a></h3><table tabindex="0"><thead><tr><th>源坐标系</th><th>目标：BD-09</th><th>偏差范围</th></tr></thead><tbody><tr><td>WGS84 → BD-09</td><td>需要转换</td><td>100-300 米</td></tr><tr><td>GCJ-02 → BD-09</td><td>需要转换</td><td>50-100 米</td></tr><tr><td>BD-09 → BD-09</td><td>无需转换</td><td>0 米</td></tr></tbody></table><h3 id="常见坐标类型-不要混淆" tabindex="-1">常见坐标类型（不要混淆） <a class="header-anchor" href="#常见坐标类型-不要混淆" aria-label="Permalink to &quot;常见坐标类型（不要混淆）&quot;">​</a></h3><p>做地图业务时，“坐标”不止经纬度一种。很多线上 Bug 的根因是：把不同类型的坐标混用了。</p><ol><li><p><strong>地理坐标（经纬度）</strong></p><ul><li>通常以 <code>lng/lat</code> 表示。</li><li>常见参考系/坐标系：<strong>WGS84 / GCJ-02 / BD-09</strong>。</li></ul></li><li><p><strong>投影坐标（Projected Coordinates）</strong></p><ul><li>把球面/椭球面映射到平面后的坐标（单位通常是米/投影单位）。</li><li>Web 地图最常见：<strong>Web Mercator（EPSG:3857）</strong>。</li><li>容易踩坑：把 EPSG:3857 的 <code>x/y</code> 当成 <code>lng/lat</code> 存库或回传。</li></ul></li><li><p><strong>屏幕/像素坐标（Screen / Pixel / Container Point）</strong></p><ul><li>鼠标点击位置、DOM 容器内像素点（单位是 px）。</li><li>常见于：拖拽绘制、框选、多边形编辑、命中测试（hit test）。</li><li>重要：像素坐标只有在<strong>特定 zoom、pitch、bearing、viewport</strong>下才有意义。</li></ul></li><li><p><strong>瓦片坐标（Tile XYZ / TMS）</strong></p><ul><li>形如 <code>(z, x, y)</code> 的瓦片索引，用于切片地图。</li><li>注意：XYZ 与 TMS 的 <code>y</code> 方向相反；不同瓦片服务可能有不同 tileMatrix。</li></ul></li><li><p><strong>局部/工程坐标（Local / Grid / CAD）</strong></p><ul><li>例如工地/园区/室内定位常见的“平面直角坐标”，单位米或厘米。</li><li>必须有明确的“与地理坐标的基准转换关系”，否则无法叠加在地图上。</li></ul></li></ol><blockquote><p>建议：接口/数据库字段命名时就区分类型，例如 <code>lng/lat</code>、<code>mercatorX/mercatorY</code>、<code>pixelX/pixelY</code>、<code>tileX/tileY/tileZ</code>。</p></blockquote><hr><h2 id="🗺️-常用地图-api-介绍" tabindex="-1">🗺️ 常用地图 API 介绍 <a class="header-anchor" href="#🗺️-常用地图-api-介绍" aria-label="Permalink to &quot;🗺️ 常用地图 API 介绍&quot;">​</a></h2><h3 id="国内主流地图服务商" tabindex="-1">国内主流地图服务商 <a class="header-anchor" href="#国内主流地图服务商" aria-label="Permalink to &quot;国内主流地图服务商&quot;">​</a></h3><p>在国内地图开发中，主要有以下几个主流地图服务商，每个都使用不同的坐标系：</p><table tabindex="0"><thead><tr><th>地图服务</th><th>官方文档</th><th>坐标系</th><th>JavaScript API 版本</th><th>特点</th></tr></thead><tbody><tr><td><strong>百度地图</strong></td><td><a href="https://lbsyun.baidu.com/" target="_blank" rel="noreferrer">lbsyun.baidu.com</a></td><td><strong>BD-09</strong></td><td>BMapGL / BMap</td><td>国内使用最广泛，功能丰富</td></tr><tr><td><strong>高德地图</strong></td><td><a href="https://lbs.amap.com/" target="_blank" rel="noreferrer">lbs.amap.com</a></td><td><strong>GCJ-02</strong></td><td>AMap</td><td>阿里旗下，POI 数据丰富</td></tr><tr><td><strong>腾讯地图</strong></td><td><a href="https://lbs.qq.com/" target="_blank" rel="noreferrer">lbs.qq.com</a></td><td><strong>GCJ-02</strong></td><td>qq.maps</td><td>腾讯旗下，集成微信生态</td></tr><tr><td><strong>天地图</strong></td><td><a href="http://www.tianditu.gov.cn/" target="_blank" rel="noreferrer">www.tianditu.gov.cn</a></td><td><strong>GCJ-02</strong></td><td>T.Map</td><td>国家基础地理信息中心，适合政府项目</td></tr><tr><td><strong>Mapbox</strong></td><td><a href="https://docs.mapbox.com/" target="_blank" rel="noreferrer">docs.mapbox.com</a></td><td><strong>WGS84</strong></td><td>Mapbox GL JS</td><td>国际服务，样式自定义度高</td></tr><tr><td><strong>OpenStreetMap</strong></td><td><a href="https://www.openstreetmap.org/" target="_blank" rel="noreferrer">www.openstreetmap.org</a></td><td><strong>WGS84</strong></td><td>Leaflet / OpenLayers</td><td>开源地图，适合定制化需求</td></tr></tbody></table><h3 id="_1-百度地图-baidu-maps" tabindex="-1">1. 百度地图 (Baidu Maps) <a class="header-anchor" href="#_1-百度地图-baidu-maps" aria-label="Permalink to &quot;1. 百度地图 (Baidu Maps)&quot;">​</a></h3><p><strong>坐标系</strong>：BD-09（百度坐标系）</p><p><strong>API 文档</strong>：<a href="https://lbsyun.baidu.com/index.php?title=jspopularGL" target="_blank" rel="noreferrer">百度地图开放平台</a></p><p><strong>特点</strong>：</p><ul><li>✅ 国内使用最广泛的地图服务</li><li>✅ 功能丰富，API 文档完善</li><li>✅ 提供 WebGL 版本（BMapGL）和传统版本（BMap）</li><li>✅ POI（兴趣点）数据丰富</li><li>⚠️ 使用 BD-09 坐标系，与其他地图不兼容</li></ul><p><strong>适用场景</strong>：</p><ul><li>国内商业项目</li><li>需要丰富 POI 数据的应用</li><li>对地图功能要求较高的项目</li></ul><p><strong>示例代码</strong>：</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 伪代码：以官方 SDK 为准</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> map</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createMapInstance</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ provider: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;baidu&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">map.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setView</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ lng: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">116.404</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, lat: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">39.915</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, zoom: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">15</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 点击事件返回 BD-09 坐标（百度原生）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">map.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;click&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">event</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">lng</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">lat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> map.adapter.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">extractCoordFromEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(event);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;坐标:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, lng, lat, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;system=BD09&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_2-高德地图-amap" tabindex="-1">2. 高德地图 (AMap) <a class="header-anchor" href="#_2-高德地图-amap" aria-label="Permalink to &quot;2. 高德地图 (AMap)&quot;">​</a></h3><p><strong>坐标系</strong>：GCJ-02（火星坐标系）</p><p><strong>API 文档</strong>：<a href="https://lbs.amap.com/api/javascript-api/summary" target="_blank" rel="noreferrer">高德开放平台</a></p><p><strong>特点</strong>：</p><ul><li>✅ 阿里旗下，与支付宝、淘宝等生态集成</li><li>✅ POI 数据非常丰富</li><li>✅ 路况信息准确</li><li>✅ API 设计简洁易用</li><li>⚠️ 使用 GCJ-02 坐标系，需要转换才能在百度地图显示</li></ul><p><strong>适用场景</strong>：</p><ul><li>电商、生活服务类应用</li><li>需要准确路况信息的导航应用</li><li>与阿里系产品集成的项目</li></ul><p><strong>示例代码</strong>：</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 伪代码：以官方 SDK 为准</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> map</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createMapInstance</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ provider: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;amap&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">map.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setView</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ lng: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">116.397428</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, lat: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">39.90923</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, zoom: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">13</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 点击事件返回 GCJ-02 坐标（高德原生）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">map.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;click&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">event</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">lng</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">lat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> map.adapter.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">extractCoordFromEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(event);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;坐标:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, lng, lat, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;system=GCJ02&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_3-腾讯地图-tencent-maps" tabindex="-1">3. 腾讯地图 (Tencent Maps) <a class="header-anchor" href="#_3-腾讯地图-tencent-maps" aria-label="Permalink to &quot;3. 腾讯地图 (Tencent Maps)&quot;">​</a></h3><p><strong>坐标系</strong>：GCJ-02（火星坐标系）</p><p><strong>API 文档</strong>：<a href="https://lbs.qq.com/service/webService/webServiceGuide/webServiceOverview" target="_blank" rel="noreferrer">腾讯位置服务</a></p><p><strong>特点</strong>：</p><ul><li>✅ 腾讯旗下，与微信、QQ 生态集成</li><li>✅ 微信小程序内置支持</li><li>✅ API 风格与高德相似</li><li>✅ 适合社交类应用</li><li>⚠️ 使用 GCJ-02 坐标系</li></ul><p><strong>适用场景</strong>：</p><ul><li>微信小程序、H5 应用</li><li>社交类应用</li><li>需要分享到微信/QQ 的功能</li></ul><p><strong>示例代码</strong>：</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 伪代码：以官方 SDK 为准</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> map</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createMapInstance</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ provider: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;tencent&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">map.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setView</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ lng: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">116.397128</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, lat: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">39.916527</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, zoom: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">13</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 点击事件返回 GCJ-02 坐标（腾讯原生）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">map.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;click&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">event</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">lng</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">lat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> map.adapter.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">extractCoordFromEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(event);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;坐标:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, lng, lat, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;system=GCJ02&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_4-天地图-tianditu" tabindex="-1">4. 天地图 (Tianditu) <a class="header-anchor" href="#_4-天地图-tianditu" aria-label="Permalink to &quot;4. 天地图 (Tianditu)&quot;">​</a></h3><p><strong>坐标系</strong>：GCJ-02（火星坐标系）</p><p><strong>API 文档</strong>：<a href="http://lbs.tianditu.gov.cn/" target="_blank" rel="noreferrer">国家地理信息公共服务平台</a></p><p><strong>特点</strong>：</p><ul><li>✅ 国家基础地理信息中心提供</li><li>✅ 数据权威，适合政府项目</li><li>✅ 提供多种地图底图（影像、地形等）</li><li>✅ 完全免费使用</li><li>⚠️ 功能相对简单，主要提供基础地图服务</li></ul><p><strong>适用场景</strong>：</p><ul><li>政府项目、公共服务类应用</li><li>需要权威地理数据的项目</li><li>预算有限的公益项目</li></ul><p><strong>示例代码</strong>：</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 伪代码：以官方 SDK 为准</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> map</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createMapInstance</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ provider: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;tianditu&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">map.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setView</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ lng: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">116.40769</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, lat: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">39.89945</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, zoom: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">13</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 点击事件返回 GCJ-02 坐标（天地图原生）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">map.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;click&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">event</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">lng</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">lat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> map.adapter.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">extractCoordFromEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(event);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;坐标:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, lng, lat, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;system=GCJ02&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_5-mapbox" tabindex="-1">5. Mapbox <a class="header-anchor" href="#_5-mapbox" aria-label="Permalink to &quot;5. Mapbox&quot;">​</a></h3><p><strong>坐标系</strong>：WGS84（国际标准坐标系）</p><p><strong>API 文档</strong>：<a href="https://docs.mapbox.com/mapbox-gl-js/" target="_blank" rel="noreferrer">Mapbox GL JS</a></p><p><strong>特点</strong>：</p><ul><li>✅ 国际主流地图服务</li><li>✅ 样式高度自定义</li><li>✅ 性能优秀，支持大数据量渲染</li><li>✅ 开源社区活跃</li><li>⚠️ 国内访问需要代理或使用国内镜像</li><li>⚠️ 商业使用需要付费</li></ul><p><strong>适用场景</strong>：</p><ul><li>国际化应用</li><li>需要高度自定义地图样式的项目</li><li>数据可视化、GIS 应用</li></ul><p><strong>示例代码</strong>：</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 伪代码：以官方 SDK 为准</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> map</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createMapInstance</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ provider: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;mapbox&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">map.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setView</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ lng: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">116.4074</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, lat: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">39.9042</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, zoom: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">13</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 点击事件返回 WGS84 坐标（Mapbox 原生）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">map.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;click&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">event</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">lng</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">lat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> map.adapter.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">extractCoordFromEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(event);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;坐标:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, lng, lat, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;system=WGS84&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_6-openstreetmap-osm" tabindex="-1">6. OpenStreetMap (OSM) <a class="header-anchor" href="#_6-openstreetmap-osm" aria-label="Permalink to &quot;6. OpenStreetMap (OSM)&quot;">​</a></h3><p><strong>坐标系</strong>：WGS84（国际标准坐标系）</p><p><strong>特点</strong>：</p><ul><li>✅ 完全开源免费</li><li>✅ 数据由全球志愿者贡献</li><li>✅ 支持多种地图框架（Leaflet、OpenLayers 等）</li><li>✅ 可自行搭建服务</li><li>⚠️ 国内数据可能不够详细</li><li>⚠️ 需要自行选择地图服务商（如 MapTiler、Stadia Maps 等）</li></ul><p><strong>适用场景</strong>：</p><ul><li>开源项目</li><li>需要完全控制地图服务的项目</li><li>国际化开源应用</li></ul><h3 id="地图-api-选择建议" tabindex="-1">地图 API 选择建议 <a class="header-anchor" href="#地图-api-选择建议" aria-label="Permalink to &quot;地图 API 选择建议&quot;">​</a></h3><p><strong>选择维度</strong>：</p><table tabindex="0"><thead><tr><th>需求</th><th>推荐地图</th><th>理由</th></tr></thead><tbody><tr><td>国内商业项目</td><td>百度地图 / 高德地图</td><td>功能丰富，文档完善</td></tr><tr><td>政府项目</td><td>天地图</td><td>数据权威，免费</td></tr><tr><td>微信小程序</td><td>腾讯地图</td><td>原生支持，集成方便</td></tr><tr><td>国际化应用</td><td>Mapbox / OpenStreetMap</td><td>使用 WGS84，国际通用</td></tr><tr><td>高度自定义样式</td><td>Mapbox</td><td>样式系统强大</td></tr><tr><td>预算有限</td><td>天地图 / OpenStreetMap</td><td>完全免费</td></tr><tr><td>需要丰富 POI</td><td>百度地图 / 高德地图</td><td>POI 数据丰富</td></tr></tbody></table><h3 id="坐标系兼容性总结" tabindex="-1">坐标系兼容性总结 <a class="header-anchor" href="#坐标系兼容性总结" aria-label="Permalink to &quot;坐标系兼容性总结&quot;">​</a></h3><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>┌─────────────────────────────────────────────────────────┐</span></span>
<span class="line"><span>│                    坐标系兼容矩阵                        │</span></span>
<span class="line"><span>├──────────┬──────────┬──────────┬──────────┬──────────┤</span></span>
<span class="line"><span>│          │ WGS84    │ GCJ-02   │ BD-09    │ 备注     │</span></span>
<span class="line"><span>├──────────┼──────────┼──────────┼──────────┼──────────┤</span></span>
<span class="line"><span>│ 百度地图  │ ❌ 需转换 │ ❌ 需转换 │ ✅ 原生  │ BD-09    │</span></span>
<span class="line"><span>│ 高德地图  │ ❌ 需转换 │ ✅ 原生   │ ❌ 需转换 │ GCJ-02   │</span></span>
<span class="line"><span>│ 腾讯地图  │ ❌ 需转换 │ ✅ 原生   │ ❌ 需转换 │ GCJ-02   │</span></span>
<span class="line"><span>│ 天地图    │ ❌ 需转换 │ ✅ 原生   │ ❌ 需转换 │ GCJ-02   │</span></span>
<span class="line"><span>│ Mapbox   │ ✅ 原生   │ ❌ 需转换 │ ❌ 需转换 │ WGS84    │</span></span>
<span class="line"><span>│ GPS设备   │ ✅ 原生   │ ❌ 需转换 │ ❌ 需转换 │ WGS84    │</span></span>
<span class="line"><span>└──────────┴──────────┴──────────┴──────────┴──────────┘</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><strong>关键提示</strong>：</p><ul><li>🔴 <strong>百度地图</strong>与其他所有地图都不兼容（BD-09 是独立坐标系）</li><li>🟡 <strong>高德、腾讯、天地图</strong>之间可以互用（都使用 GCJ-02）</li><li>🟢 <strong>Mapbox、GPS</strong> 使用 WGS84，但需要转换才能在中国地图上显示</li></ul><hr><h2 id="🧭-统一坐标策略" tabindex="-1">🧭 统一坐标策略 <a class="header-anchor" href="#🧭-统一坐标策略" aria-label="Permalink to &quot;🧭 统一坐标策略&quot;">​</a></h2><p>如果希望这份文档能作为<strong>长期可复用的坐标体系指导</strong>，关键不在于记住“某一家地图怎么用”，而是建立一套<strong>与地图服务商解耦</strong>的坐标处理机制：</p><h3 id="目标" tabindex="-1">目标 <a class="header-anchor" href="#目标" aria-label="Permalink to &quot;目标&quot;">​</a></h3><ul><li><strong>业务层只认一种“内部坐标”</strong>（Internal Coordinate），避免到处 <code>if (baidu) ... else if (amap) ...</code>。</li><li><strong>渲染层按 Provider 转换</strong>：百度/高德/腾讯/天地图/Mapbox 各自吃各自的坐标系。</li><li><strong>数据层可追溯</strong>：任何坐标都带元数据（来源/坐标系/精度/时间），避免“同一个字段到底是什么坐标系”。</li></ul><h3 id="推荐的工程落地-通用架构" tabindex="-1">推荐的工程落地（通用架构） <a class="header-anchor" href="#推荐的工程落地-通用架构" aria-label="Permalink to &quot;推荐的工程落地（通用架构）&quot;">​</a></h3><ol><li><p><strong>定义内部统一坐标系（Internal System）</strong></p><ul><li><strong>如果主要面向国内地图（高德/腾讯/天地图）</strong>：建议内部统一为 <strong>GCJ-02</strong>（减少渲染转换成本）。</li><li><strong>如果有国际化/卫星/GIS 需求（Mapbox/OSM）</strong>：建议内部统一为 <strong>WGS84</strong>（全球通用）。</li><li><strong>如果必须以百度地图为主渲染</strong>：内部可统一为 <strong>BD-09</strong>，但要接受“对外系统几乎都要转换”。</li></ul><p>建议在工程里用常量统一声明（示例）：</p></li></ol><div class="language-ts vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> INTERNAL_SYSTEM</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CoordinateSystem</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;GCJ02&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 或 &#39;WGS84&#39; / &#39;BD09&#39;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ol start="2"><li><p><strong>引入 Provider 适配层（Adapter）</strong></p><ul><li>业务只传 <code>Coord</code>（内部坐标）。</li><li>适配层负责： <ul><li><code>toProviderCoord(internalCoord)</code></li><li><code>fromProviderCoord(providerCoord)</code>（比如地图点击返回）</li><li><code>normalizeEvent(event)</code>（统一点击/拖拽事件的坐标字段差异）</li></ul></li></ul></li><li><p><strong>数据库/接口字段必须带坐标系元数据</strong></p></li></ol><p>建议数据结构（示例）：</p><div class="language-ts vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">type</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CoordinateSystem</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;WGS84&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;GCJ02&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;BD09&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">type</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CoordinateSource</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;PROVIDER_SDK&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // 地图 SDK 交互返回（点击/拖拽等）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;BACKEND_API&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // 业务后端接口返回</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;GPS_DEVICE&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // GPS/硬件设备</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;THIRD_PARTY_API&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // 第三方服务</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;DATABASE&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // 历史库数据</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;UNKNOWN&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Coord</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  lng</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  lat</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  system</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CoordinateSystem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 坐标系（强制）</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  source</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CoordinateSource</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 来源（可选但推荐）</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  precision</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 小数位（可选）</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  timestamp</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 采集时间（可选）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="一句话原则-最重要" tabindex="-1">一句话原则（最重要） <a class="header-anchor" href="#一句话原则-最重要" aria-label="Permalink to &quot;一句话原则（最重要）&quot;">​</a></h3><blockquote><p><strong>任何坐标在进入业务层之前必须“归一化”为内部坐标系；任何坐标在进入地图渲染之前必须“转换”为 Provider 坐标系”。</strong></p></blockquote><hr><h2 id="📊-项目中的坐标使用情况" tabindex="-1">📊 项目中的坐标使用情况 <a class="header-anchor" href="#📊-项目中的坐标使用情况" aria-label="Permalink to &quot;📊 项目中的坐标使用情况&quot;">​</a></h2><h3 id="数据来源分析" tabindex="-1">数据来源分析 <a class="header-anchor" href="#数据来源分析" aria-label="Permalink to &quot;数据来源分析&quot;">​</a></h3><p>在开发地图应用时，通常有以下几种数据来源：</p><h4 id="_1-地图-sdk-点击-拖拽获取-provider-原生坐标" tabindex="-1">1. 地图 SDK 点击/拖拽获取（Provider 原生坐标） <a class="header-anchor" href="#_1-地图-sdk-点击-拖拽获取-provider-原生坐标" aria-label="Permalink to &quot;1. 地图 SDK 点击/拖拽获取（Provider 原生坐标）&quot;">​</a></h4><p><strong>常见场景</strong>：用户在地图上点击或拖拽标记获取坐标</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 伪代码：地图点击事件 → Provider 坐标 → 内部坐标</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">map.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;click&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">event</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> providerCoord</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> adapter.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">extractCoordFromEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(event); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// { lng, lat }（provider 坐标系）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> internalCoord</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> adapter.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fromProvider</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(providerCoord); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// { lng, lat, system: INTERNAL_SYSTEM }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 业务只用 internalCoord；渲染再转回 provider</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  store.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">saveLastClickCoord</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(internalCoord);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>特点</strong>：</p><ul><li>✅ 坐标系：<strong>取决于 Provider</strong><ul><li>百度：BD-09</li><li>高德/腾讯/天地图：GCJ-02</li><li>Mapbox/OSM：WGS84</li></ul></li><li>✅ 精度：一般可保留 6 位小数（对业务足够）</li><li>⚠️ 点击得到的坐标必须先<strong>归一化为 INTERNAL_SYSTEM</strong>，再进入业务流程</li></ul><h4 id="_2-从数据库读取-⚠️-必须确认-历史数据坐标系" tabindex="-1">2. 从数据库读取（⚠️ 必须确认：历史数据坐标系） <a class="header-anchor" href="#_2-从数据库读取-⚠️-必须确认-历史数据坐标系" aria-label="Permalink to &quot;2. 从数据库读取（⚠️ 必须确认：历史数据坐标系）&quot;">​</a></h4><p><strong>常见场景</strong>：从数据库加载之前保存的绘制数据或标记点</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 从数据库加载绘制数据</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> drawData</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> db.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">collection</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;map_items&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">drawData.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">forEach</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">item</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  mapSdk.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addMarker</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ lng: item.point.lng, lat: item.point.lat });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>特点</strong>：</p><ul><li>📝 数据格式：<code>{ point: { lng, lat }, ... }</code></li><li>📝 保存来源：可能是地图 SDK 交互、后台导入、第三方 API</li><li>⚠️ 如果保存时没有转换，可能有偏差</li></ul><h4 id="_3-后台管理系统导入-❌-未知-需要确认" tabindex="-1">3. 后台管理系统导入（❌ 未知：需要确认） <a class="header-anchor" href="#_3-后台管理系统导入-❌-未知-需要确认" aria-label="Permalink to &quot;3. 后台管理系统导入（❌ 未知：需要确认）&quot;">​</a></h4><p><strong>常见场景</strong>：从后端 API 或管理后台导入 POI（兴趣点）数据</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 处理后台导入的数据</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> resultData</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> api.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getLocationList</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> validData</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> resultData.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">filter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">item</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> item.name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> item.lat </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> item.lng</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 直接使用，未转换 - 可能有偏差</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mapInstance.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addMarkers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(validData);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>特点</strong>：</p><ul><li>❓ 坐标系：<strong>未知</strong>（可能是 WGS84、GCJ-02 或其他）</li><li>⚠️ <strong>最可能出现偏差</strong>：需要明确坐标系并转换</li></ul><h4 id="_4-第三方-api-数据处理-❌-未转换" tabindex="-1">4. 第三方 API 数据处理（❌ 未转换） <a class="header-anchor" href="#_4-第三方-api-数据处理-❌-未转换" aria-label="Permalink to &quot;4. 第三方 API 数据处理（❌ 未转换）&quot;">​</a></h4><p><strong>常见场景</strong>：从第三方 API 或工作流系统获取位置数据</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 处理第三方 API 返回的数据</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> apiData</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetchLocationData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> processedData</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> processApiData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(apiData);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// processedData 包含 { lng, lat }，直接使用</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 直接使用，未转换</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mapInstance.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addMarkers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(processedData);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>特点</strong>：</p><ul><li>❓ 坐标系：<strong>未知</strong>（从第三方 API 返回）</li><li>⚠️ 需要确认 API 返回的坐标系</li></ul><h3 id="数据保存流程" tabindex="-1">数据保存流程 <a class="header-anchor" href="#数据保存流程" aria-label="Permalink to &quot;数据保存流程&quot;">​</a></h3><p><strong>常见场景</strong>：保存地图绘制数据到数据库</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 保存绘制数据到数据库</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> saveMapData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">drawData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> result</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> db.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">collection</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;map_drawings&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(drawData);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // drawData 格式：{ point: { lng, lat }, ... }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>问题</strong>：</p><ul><li>当前保存时<strong>没有记录坐标系信息</strong></li><li>未来读取时无法知道原始坐标系</li></ul><hr><h2 id="🛠️-工具函数使用说明" tabindex="-1">🛠️ 工具函数使用说明 <a class="header-anchor" href="#🛠️-工具函数使用说明" aria-label="Permalink to &quot;🛠️ 工具函数使用说明&quot;">​</a></h2><p>建议工具文件：<code>src/utils/geo/coordinate.ts</code>（示例）</p><h3 id="枚举定义" tabindex="-1">枚举定义 <a class="header-anchor" href="#枚举定义" aria-label="Permalink to &quot;枚举定义&quot;">​</a></h3><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 坐标系类型</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> CoordinateSystem</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  WGS84: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;WGS84&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// GPS 坐标系</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  GCJ02: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;GCJ02&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 火星坐标系（高德、腾讯）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  BD09: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;BD09&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 百度坐标系</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 数据来源</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> CoordinateSource</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  PROVIDER_SDK: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;PROVIDER_SDK&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 地图 SDK 交互返回（点击/拖拽等）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  BACKEND_API: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;BACKEND_API&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 业务后端接口返回</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  GPS_DEVICE: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;GPS_DEVICE&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// GPS 设备原始数据（WGS84）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  THIRD_PARTY_API: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;THIRD_PARTY_API&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 第三方服务/工作流</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  DATABASE: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;DATABASE&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 从数据库读取（必须带 system 才可靠）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  UNKNOWN: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;UNKNOWN&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 未知来源（强烈建议尽快补齐 system）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="核心函数列表" tabindex="-1">核心函数列表 <a class="header-anchor" href="#核心函数列表" aria-label="Permalink to &quot;核心函数列表&quot;">​</a></h3><h4 id="_1-基础转换函数" tabindex="-1">1. 基础转换函数 <a class="header-anchor" href="#_1-基础转换函数" aria-label="Permalink to &quot;1. 基础转换函数&quot;">​</a></h4><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// WGS84 → BD-09</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">wgs84ToBd09</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(lat, lng);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// GCJ-02 → BD-09</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gcj02ToBd09Convert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(lat, lng);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// BD-09 → GCJ-02</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">bd09ToGcj02Convert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(lat, lng);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// BD-09 → WGS84</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">bd09ToWgs84</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(lat, lng);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="_2-统一转换接口" tabindex="-1">2. 统一转换接口 <a class="header-anchor" href="#_2-统一转换接口" aria-label="Permalink to &quot;2. 统一转换接口&quot;">​</a></h4><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 任意坐标系 → 指定坐标系（推荐：内部统一坐标系）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">convertCoord</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ lat, lng }, { fromSystem, toSystem });</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="_3-坐标验证函数" tabindex="-1">3. 坐标验证函数 <a class="header-anchor" href="#_3-坐标验证函数" aria-label="Permalink to &quot;3. 坐标验证函数&quot;">​</a></h4><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 验证坐标值</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isValidCoordinate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(lat, lng);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 验证坐标对象</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isValidCoordinateObject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(coord);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="_4-高级处理函数" tabindex="-1">4. 高级处理函数 <a class="header-anchor" href="#_4-高级处理函数" aria-label="Permalink to &quot;4. 高级处理函数&quot;">​</a></h4><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 处理单个坐标点（推荐）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">normalizeCoord</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ lat, lng }, options);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 处理坐标对象（推荐）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">normalizeCoordObject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(coord, options);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 批量处理坐标数组</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">normalizeCoordArray</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(coords, options);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 处理绘图数据（支持 point、center、paths）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">normalizeDrawingData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(drawData, options);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="_5-provider-适配-强烈推荐" tabindex="-1">5. Provider 适配（强烈推荐） <a class="header-anchor" href="#_5-provider-适配-强烈推荐" aria-label="Permalink to &quot;5. Provider 适配（强烈推荐）&quot;">​</a></h4><p>不要把“百度/高德/腾讯”等 SDK 类型渗透到业务层；建议通过适配器隔离：</p><div class="language-ts vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">type</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Provider</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;baidu&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;amap&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;tencent&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;tianditu&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;mapbox&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;osm&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ProviderAdapter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  provider</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Provider</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  providerSystem</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;BD09&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;GCJ02&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;WGS84&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 地图 SDK 事件 → 坐标（Provider 坐标系）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  extractCoordFromEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">event</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> unknown</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">lng</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">lat</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 内部坐标 ↔ Provider 坐标</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  toProvider</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">coordInternal</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Coord</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">lng</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">lat</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> };</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  fromProvider</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">coordProvider</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">lng</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">lat</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> })</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Coord</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h4 id="_6-辅助工具函数" tabindex="-1">6. 辅助工具函数 <a class="header-anchor" href="#_6-辅助工具函数" aria-label="Permalink to &quot;6. 辅助工具函数&quot;">​</a></h4><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 计算两点距离（米）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">calculateDistance</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(lat1, lng1, lat2, lng2);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 标记坐标元数据（保存到数据库时使用）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">markCoordinateMetadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data, source, system);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="函数参数说明" tabindex="-1">函数参数说明 <a class="header-anchor" href="#函数参数说明" aria-label="Permalink to &quot;函数参数说明&quot;">​</a></h3><h4 id="normalizecoord-lat-lng-options" tabindex="-1"><code>normalizeCoord({ lat, lng }, options)</code> <a class="header-anchor" href="#normalizecoord-lat-lng-options" aria-label="Permalink to &quot;`normalizeCoord({ lat, lng }, options)`&quot;">​</a></h4><p><strong>参数</strong>：</p><ul><li><code>lat</code> (number): 纬度</li><li><code>lng</code> (number): 经度</li><li><code>options</code> (Object): 配置选项 <ul><li><code>source</code> (string): 数据来源（<code>CoordinateSource</code> 枚举值）</li><li><code>fromSystem</code> (string): 源坐标系（<code>CoordinateSystem</code>）</li><li><code>toSystem</code> (string): 目标坐标系（推荐：<code>INTERNAL_SYSTEM</code>）</li><li><code>precision</code> (number): 精度（小数位数，默认 6）</li></ul></li></ul><p><strong>返回</strong>：<code>{ lat: number, lng: number }</code> - <code>toSystem</code> 对应的坐标</p><p><strong>示例</strong>：</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> result</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> normalizeCoord</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  { lat: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">33.995046</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, lng: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">119.8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    source: CoordinateSource.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">BACKEND_API</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    fromSystem: CoordinateSystem.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">WGS84</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    toSystem: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">INTERNAL_SYSTEM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    precision: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">6</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 返回转换后的内部坐标（INTERNAL_SYSTEM）</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><hr><h2 id="💡-实际应用示例" tabindex="-1">💡 实际应用示例 <a class="header-anchor" href="#💡-实际应用示例" aria-label="Permalink to &quot;💡 实际应用示例&quot;">​</a></h2><h3 id="示例-1-处理地图点击事件-provider-无关" tabindex="-1">示例 1：处理地图点击事件（Provider 无关） <a class="header-anchor" href="#示例-1-处理地图点击事件-provider-无关" aria-label="Permalink to &quot;示例 1：处理地图点击事件（Provider 无关）&quot;">​</a></h3><p><strong>场景</strong>：用户在地图上点击获取坐标</p><p><strong>修改前</strong>：</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 业务层（错误示范）：直接读取 SDK event 字段并当成“统一坐标”使用</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">map.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;click&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">event</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // event 的字段结构、坐标系都与 provider 绑定</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ❌ 不要在业务里直接依赖它</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>修改后</strong>：</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 正确做法：通过适配器提取并归一化为内部坐标</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">map.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;click&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">event</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> providerCoord</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> adapter.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">extractCoordFromEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(event); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// { lng, lat }（provider 坐标系）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> internalCoord</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> adapter.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fromProvider</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(providerCoord); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// { lng, lat, system: INTERNAL_SYSTEM }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 业务只用 internalCoord</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  store.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">saveLastClickCoord</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(internalCoord);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="示例-2-处理后台导入的-poi-数据" tabindex="-1">示例 2：处理后台导入的 POI 数据 <a class="header-anchor" href="#示例-2-处理后台导入的-poi-数据" aria-label="Permalink to &quot;示例 2：处理后台导入的 POI 数据&quot;">​</a></h3><p><strong>场景</strong>：从后端 API 获取地点坐标数据</p><p><strong>修改前</strong>：</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 数据处理模块</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> resultData</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> api.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getLocationList</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> validData</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> resultData.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">filter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">item</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> item.name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> item.lat </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> item.lng</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mapInstance.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addMarkers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(validData); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 直接使用，可能有偏差</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>修改后</strong>：</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 正确做法：后端必须声明坐标系；前端统一转换到 INTERNAL_SYSTEM</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> resultData</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> api.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getLocationList</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 假设后台返回的是 WGS84 坐标（需要与后端确认）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> validData</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> resultData</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">filter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">item</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> item.name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> item.lat </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> item.lng)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">map</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">item</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ({</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">item,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    coord: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">normalizeCoord</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      { lat: item.lat, lng: item.lng },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        source: CoordinateSource.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">BACKEND_API</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        fromSystem: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;WGS84&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 由后端声明</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        toSystem: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">INTERNAL_SYSTEM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mapInstance.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addMarkers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(validData.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">map</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">x</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> adapter.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toProvider</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(x.coord))); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 现在坐标准确了！</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="示例-3-从数据库加载绘制数据" tabindex="-1">示例 3：从数据库加载绘制数据 <a class="header-anchor" href="#示例-3-从数据库加载绘制数据" aria-label="Permalink to &quot;示例 3：从数据库加载绘制数据&quot;">​</a></h3><p><strong>场景</strong>：从数据库读取已保存的绘制数据</p><p><strong>修改前</strong>：</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 数据加载模块</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> drawData</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> db.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">collection</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;map_drawings&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">drawData.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">forEach</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">item</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ❌ 错误示范：不知道 item.point 的 system 就直接渲染</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  mapSdk.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addMarker</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(item.point);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>修改后</strong>：</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> drawData</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> db.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">collection</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;map_drawings&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">drawData.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">forEach</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">item</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 正确做法：库中存储 system；读取后先归一化为 INTERNAL_SYSTEM，再转为 provider 坐标渲染</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> normalized</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> normalizeDrawingData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(item, { toSystem: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">INTERNAL_SYSTEM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  mapSdk.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">renderDrawing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(adapter.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toProviderDrawing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(normalized));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="示例-4-保存数据时标记坐标系" tabindex="-1">示例 4：保存数据时标记坐标系 <a class="header-anchor" href="#示例-4-保存数据时标记坐标系" aria-label="Permalink to &quot;示例 4：保存数据时标记坐标系&quot;">​</a></h3><p><strong>场景</strong>：保存绘制数据到数据库时记录坐标系信息</p><p><strong>修改前</strong>：</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 数据保存模块</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> saveMapData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">drawData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> result</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> db.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">collection</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;map_drawings&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(drawData);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 没有记录坐标系信息</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>修改后</strong>：</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> saveMapData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">drawData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 标记坐标来源和坐标系</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> dataToSave</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> markCoordinateMetadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    drawData,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    CoordinateSource.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">PROVIDER_SDK</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    INTERNAL_SYSTEM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  );</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> result</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> db.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">collection</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;map_drawings&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(dataToSave);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 现在数据库中包含了坐标系信息，后续读取时可以自动转换</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="示例-5-处理第三方-api-的统计数据" tabindex="-1">示例 5：处理第三方 API 的统计数据 <a class="header-anchor" href="#示例-5-处理第三方-api-的统计数据" aria-label="Permalink to &quot;示例 5：处理第三方 API 的统计数据&quot;">​</a></h3><p><strong>场景</strong>：处理从第三方 API 获取的统计数据</p><p><strong>修改前</strong>：</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// API 数据处理模块</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> apiData</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetchStatisticsData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> processedData</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> processData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(apiData);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mapInstance.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addMarkers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(processedData); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 直接使用</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>修改后</strong>：</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> apiData</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetchStatisticsData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> processedData</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> processData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(apiData);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 转换坐标（第三方 API 必须声明坐标系）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> normalizedData</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> processedData.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">map</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">item</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ({</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  ...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">item,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  coord: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">normalizeCoord</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    { lat: item.lat, lng: item.lng },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      source: CoordinateSource.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">THIRD_PARTY_API</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      fromSystem: item.system,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      toSystem: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">INTERNAL_SYSTEM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mapInstance.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addMarkers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(normalizedData.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">map</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">x</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> adapter.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toProvider</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(x.coord)));</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><hr><h2 id="✅-最佳实践" tabindex="-1">✅ 最佳实践 <a class="header-anchor" href="#✅-最佳实践" aria-label="Permalink to &quot;✅ 最佳实践&quot;">​</a></h2><h3 id="_1-数据来源确认" tabindex="-1">1. 数据来源确认 <a class="header-anchor" href="#_1-数据来源确认" aria-label="Permalink to &quot;1. 数据来源确认&quot;">​</a></h3><p><strong>第一步：确认坐标来源的坐标系</strong></p><table tabindex="0"><thead><tr><th>来源</th><th>默认坐标系</th><th>需要确认</th></tr></thead><tbody><tr><td>地图 SDK 交互（百度）</td><td>BD-09</td><td>✅ 已确认</td></tr><tr><td>地图 SDK 交互（高德/腾讯/天地图）</td><td>GCJ-02</td><td>✅ 已确认</td></tr><tr><td>地图 SDK 交互（Mapbox/OSM）</td><td>WGS84</td><td>✅ 已确认</td></tr><tr><td>百度地图 WebService</td><td>BD-09</td><td>✅ 已确认</td></tr><tr><td>GPS 设备</td><td>WGS84</td><td>✅ 已确认</td></tr><tr><td>高德/腾讯 WebService</td><td>GCJ-02</td><td>✅ 已确认</td></tr><tr><td>后台导入</td><td>未知</td><td>⚠️ <strong>需要与后端确认</strong></td></tr><tr><td>工作流 API</td><td>未知</td><td>⚠️ <strong>需要与后端确认</strong></td></tr></tbody></table><p><strong>确认方法</strong>：</p><ol><li>询问后端开发人员</li><li>查看接口文档</li><li>在目标地图上测试一个已知坐标，看是否有偏移（不要只在某一家地图里验证）</li></ol><h3 id="_2-统一使用工具函数" tabindex="-1">2. 统一使用工具函数 <a class="header-anchor" href="#_2-统一使用工具函数" aria-label="Permalink to &quot;2. 统一使用工具函数&quot;">​</a></h3><p><strong>原则</strong>：所有坐标处理都通过“坐标工具模块 + Provider 适配器”，避免在业务代码里写死某一家地图 SDK 的类型/字段。</p><p><strong>推荐函数</strong>：</p><ul><li>事件提取：<code>adapter.extractCoordFromEvent(event)</code></li><li>坐标归一化：<code>normalizeCoordObject(coord, { toSystem: INTERNAL_SYSTEM })</code></li><li>绘制数据归一化：<code>normalizeDrawingData(drawData, { toSystem: INTERNAL_SYSTEM })</code></li><li>Provider 转换：<code>adapter.toProvider(coordInternal)</code> / <code>adapter.fromProvider(coordProvider)</code></li></ul><h3 id="_3-保存时记录坐标系" tabindex="-1">3. 保存时记录坐标系 <a class="header-anchor" href="#_3-保存时记录坐标系" aria-label="Permalink to &quot;3. 保存时记录坐标系&quot;">​</a></h3><p><strong>原则</strong>：保存数据到数据库时，使用 <code>markCoordinateMetadata()</code> 记录坐标系信息。</p><p><strong>好处</strong>：</p><ul><li>未来读取时可以自动转换</li><li>便于数据溯源和问题排查</li><li>支持数据迁移和转换</li></ul><p><strong>示例</strong>：</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> dataToSave</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> markCoordinateMetadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  drawData,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  CoordinateSource.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">PROVIDER_SDK</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  INTERNAL_SYSTEM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> db.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">collection</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;map_drawings&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(dataToSave);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_4-加载时自动转换" tabindex="-1">4. 加载时自动转换 <a class="header-anchor" href="#_4-加载时自动转换" aria-label="Permalink to &quot;4. 加载时自动转换&quot;">​</a></h3><p><strong>原则</strong>：从数据库或 API 加载数据时，使用 <code>normalizeDrawingData()</code> 自动转换。</p><p><strong>好处</strong>：</p><ul><li>自动识别坐标系并转换</li><li>兼容新旧数据</li><li>统一处理逻辑</li></ul><h3 id="_5-精度保留" tabindex="-1">5. 精度保留 <a class="header-anchor" href="#_5-精度保留" aria-label="Permalink to &quot;5. 精度保留&quot;">​</a></h3><p><strong>原则</strong>：所有转换后的坐标保留 6 位小数精度。</p><p><strong>说明</strong>：</p><ul><li>6 位小数精度 ≈ 0.1 米，完全满足需求</li><li>工具函数默认 <code>precision: 6</code></li><li>百度地图 API 支持 6 位小数精度</li></ul><hr><h2 id="❓-常见问题" tabindex="-1">❓ 常见问题 <a class="header-anchor" href="#❓-常见问题" aria-label="Permalink to &quot;❓ 常见问题&quot;">​</a></h2><h3 id="q1-为什么-地图点击得到的坐标-看起来也会有偏差" tabindex="-1">Q1: 为什么“地图点击得到的坐标”看起来也会有偏差？ <a class="header-anchor" href="#q1-为什么-地图点击得到的坐标-看起来也会有偏差" aria-label="Permalink to &quot;Q1: 为什么“地图点击得到的坐标”看起来也会有偏差？&quot;">​</a></h3><p><strong>A</strong>: 如果出现偏差，可能原因：</p><ol><li><strong>坐标系不匹配</strong>：例如把 GCJ-02 当 BD-09 去渲染（最常见）</li><li><strong>投影/像素坐标混用</strong>：把 EPSG:3857 / 屏幕像素坐标当经纬度</li><li><strong>标记锚点（anchor）不正确</strong>：图标中心与坐标点不重合，造成“视觉偏移”</li><li><strong>3D/倾斜视角带来的视觉错觉</strong>：pitch/bearing 下更明显，但经纬度本身未变</li></ol><p><strong>解决方法</strong>：</p><ul><li>明确每一条数据的 <code>system</code>，并在进入业务层前统一归一化到 <code>INTERNAL_SYSTEM</code></li><li>检查是否把投影/像素坐标误当经纬度</li><li>检查 marker 的 anchor/offset 设置</li></ul><h3 id="q2-如何判断数据库中数据的坐标系" tabindex="-1">Q2: 如何判断数据库中数据的坐标系？ <a class="header-anchor" href="#q2-如何判断数据库中数据的坐标系" aria-label="Permalink to &quot;Q2: 如何判断数据库中数据的坐标系？&quot;">​</a></h3><p><strong>方法 1：查看数据来源字段</strong></p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (data.system </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;BD09&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 百度坐标：渲染到高德/腾讯/天地图/Mapbox 前需要转换</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (data.system </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;GCJ02&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 火星坐标：渲染到百度前需要转换</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (data.system </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;WGS84&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // GPS/国际坐标：国内地图渲染前通常要转换到 GCJ02 或 BD09</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>方法 2：测试验证</strong> 在百度地图上测试一个已知坐标点，对比实际位置：</p><ul><li>位置准确 → BD-09</li><li>有明显偏移（几十到几百米）→ 不是 BD-09，需要转换</li></ul><p><strong>方法 3：使用工具函数自动处理</strong></p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 自动根据数据中的字段判断</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> normalized</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> normalizeDrawingData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="q3-后台导入的数据坐标系不确定怎么办" tabindex="-1">Q3: 后台导入的数据坐标系不确定怎么办？ <a class="header-anchor" href="#q3-后台导入的数据坐标系不确定怎么办" aria-label="Permalink to &quot;Q3: 后台导入的数据坐标系不确定怎么办？&quot;">​</a></h3><p><strong>A</strong>: 按以下步骤处理：</p><ol><li><strong>询问后端</strong>：明确返回的坐标系类型</li><li><strong>测试验证</strong>：在百度地图上测试几个坐标点，对比实际位置</li><li><strong>统一转换</strong>：使用工具函数，明确指定坐标系</li></ol><p><strong>示例</strong>：</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 关键前提：后端必须“声明坐标系”，否则无法可靠处理</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 如果后端声明是 WGS84</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> normalized</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> normalizeCoordObject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(coord, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  source: CoordinateSource.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">BACKEND_API</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  fromSystem: CoordinateSystem.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">WGS84</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  toSystem: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">INTERNAL_SYSTEM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 如果后端声明是 GCJ-02</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> normalized2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> normalizeCoordObject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(coord, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  source: CoordinateSource.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">BACKEND_API</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  fromSystem: CoordinateSystem.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">GCJ02</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  toSystem: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">INTERNAL_SYSTEM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="q4-数据库中的旧数据怎么办" tabindex="-1">Q4: 数据库中的旧数据怎么办？ <a class="header-anchor" href="#q4-数据库中的旧数据怎么办" aria-label="Permalink to &quot;Q4: 数据库中的旧数据怎么办？&quot;">​</a></h3><p><strong>A</strong>: 有两种处理方式：</p><p><strong>方式 1：读取时转换（前提：旧数据已带 <code>system</code>）</strong></p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 读取时统一转换到内部坐标（推荐）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> normalized</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> normalizeDrawingData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  source: CoordinateSource.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">DATABASE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  toSystem: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">INTERNAL_SYSTEM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>方式 2：批量“补齐 system + 迁移归一化”（当旧数据缺 system 或 system 不可信）</strong></p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 先确定一个“迁移假设坐标系”（必须通过抽样验证/回放确认）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> MIGRATION_ASSUMED_SYSTEM</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;GCJ02&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 例：抽样确认旧库实际是 GCJ-02</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 批量读取、归一化、并写回 system 字段</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> allData</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> db.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">collection</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;map_drawings&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> updatedData</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> allData.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">map</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">item</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> normalized</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> normalizeDrawingData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(item, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    source: CoordinateSource.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">DATABASE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    fromSystem: item.system </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">??</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> MIGRATION_ASSUMED_SYSTEM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    toSystem: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">INTERNAL_SYSTEM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 更新数据库</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> db</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">collection</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;map_drawings&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">doc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(item.id)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">update</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      ...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">normalized,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      system: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">INTERNAL_SYSTEM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      source: CoordinateSource.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">DATABASE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h3 id="q5-如何测试坐标转换是否正确" tabindex="-1">Q5: 如何测试坐标转换是否正确？ <a class="header-anchor" href="#q5-如何测试坐标转换是否正确" aria-label="Permalink to &quot;Q5: 如何测试坐标转换是否正确？&quot;">​</a></h3><p><strong>A</strong>: 使用测试工具：</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 测试坐标转换</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> original</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { lat: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">33.995046</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, lng: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">119.8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> };</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> converted</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> normalizeCoordObject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(original, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  fromSystem: CoordinateSystem.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">WGS84</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  toSystem: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;BD09&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 或 INTERNAL_SYSTEM，看你要验证哪条链路</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 计算转换后的距离差</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> distance</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> calculateDistance</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  original.lat,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  original.lng,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  converted.lat,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  converted.lng</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;转换距离差：&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, distance, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;米&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 提示：WGS84 → BD-09 通常相差 100-300 米是正常的（国内加密坐标导致）</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="q6-3d-和-2d-模式对坐标有影响吗" tabindex="-1">Q6: 3D 和 2D 模式对坐标有影响吗？ <a class="header-anchor" href="#q6-3d-和-2d-模式对坐标有影响吗" aria-label="Permalink to &quot;Q6: 3D 和 2D 模式对坐标有影响吗？&quot;">​</a></h3><p><strong>A</strong>: <strong>坐标数值不受影响</strong>，但可能有视觉偏差：</p><ul><li>✅ <strong>坐标精度</strong>：3D/2D 模式下坐标数值完全相同</li><li>⚠️ <strong>视觉偏差</strong>：3D 模式的透视投影可能造成视觉上的位置偏差</li><li>💡 <strong>建议</strong>：坐标处理与 3D/2D 模式无关，主要是显示问题</li></ul><hr><h2 id="📋-快速参考" tabindex="-1">📋 快速参考 <a class="header-anchor" href="#📋-快速参考" aria-label="Permalink to &quot;📋 快速参考&quot;">​</a></h2><h3 id="坐标系转换速查表" tabindex="-1">坐标系转换速查表 <a class="header-anchor" href="#坐标系转换速查表" aria-label="Permalink to &quot;坐标系转换速查表&quot;">​</a></h3><table tabindex="0"><thead><tr><th>转换方向</th><th>函数</th><th>偏移距离</th></tr></thead><tbody><tr><td>WGS84 → BD-09</td><td><code>wgs84ToBd09(lat, lng)</code></td><td>100-300 米</td></tr><tr><td>GCJ-02 → BD-09</td><td><code>gcj02ToBd09Convert(lat, lng)</code></td><td>50-100 米</td></tr><tr><td>BD-09 → GCJ-02</td><td><code>bd09ToGcj02Convert(lat, lng)</code></td><td>-50~100 米</td></tr><tr><td>BD-09 → WGS84</td><td><code>bd09ToWgs84(lat, lng)</code></td><td>-100~300 米</td></tr></tbody></table><h3 id="常用代码模板" tabindex="-1">常用代码模板 <a class="header-anchor" href="#常用代码模板" aria-label="Permalink to &quot;常用代码模板&quot;">​</a></h3><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 模板 1：处理地图 SDK 事件（统一提取坐标）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> providerCoord</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> adapter.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">extractCoordFromEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(event); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// { lng, lat } + providerSystem</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> internalCoord</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> adapter.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fromProvider</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(providerCoord); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 转为内部坐标（WGS84/GCJ02/BD09 之一）</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 模板 2：处理后台导入数据</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> normalized</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> normalizeCoordObject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(coord, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  fromSystem: coord.system, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 后端声明的坐标系</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  toSystem: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">INTERNAL_SYSTEM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 内部统一坐标系</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  source: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;BACKEND_API&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 模板 3：保存数据到数据库</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> dataToSave</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> markCoordinateMetadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  data,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;PROVIDER_SDK&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  INTERNAL_SYSTEM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> db.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">collection</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;map_drawings&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(dataToSave);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 模板 4：渲染到某个地图 Provider</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> providerPoint</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> adapter.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toProvider</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(internalCoord);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mapSdk.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addMarker</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(providerPoint);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><hr><h2 id="🔗-相关资源" tabindex="-1">🔗 相关资源 <a class="header-anchor" href="#🔗-相关资源" aria-label="Permalink to &quot;🔗 相关资源&quot;">​</a></h2><ul><li><strong>建议工具模块</strong>：<code>src/utils/geo/coordinate.ts</code> - 坐标系转换与归一化（示例路径）</li><li><strong>百度地图文档</strong>：<a href="https://lbsyun.baidu.com/index.php?title=jspopularGL" target="_blank" rel="noreferrer">百度地图 JavaScript API GL</a></li><li><strong>坐标系转换库</strong>：可参考 <code>coordtransform</code>、<code>coord</code> 等开源库</li><li><strong>相关概念</strong>：WGS84、GCJ-02、BD-09 坐标系转换算法</li></ul><hr><h2 id="📝-更新记录" tabindex="-1">📝 更新记录 <a class="header-anchor" href="#📝-更新记录" aria-label="Permalink to &quot;📝 更新记录&quot;">​</a></h2><ul><li><strong>v1.0.0</strong> (2025-01-XX): 初始版本，完整坐标系处理指南</li></ul><hr><p><strong>重要提示</strong>：</p><ol><li>⚠️ 所有坐标处理必须统一使用工具函数</li><li>⚠️ 保存数据时必须记录坐标系信息</li><li>⚠️ 从后台导入数据时必须明确坐标系类型</li><li>✅ 百度地图原生坐标（BD-09）无需转换</li><li>✅ 6 位小数精度完全满足需求</li></ol></div></div></main><footer class="VPDocFooter" data-v-39a288b8 data-v-e257564d><!--[--><!--]--><!----><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-e257564d><span class="visually-hidden" id="doc-footer-aria-label" data-v-e257564d>Pager</span><div class="pager" data-v-e257564d><a class="VPLink link pager-link prev" href="/myBlog/notes/frontend-basics/css-style-guide.html" data-v-e257564d><!--[--><span class="desc" data-v-e257564d>Previous page</span><span class="title" data-v-e257564d>CSS 规范文档</span><!--]--></a></div><div class="pager" data-v-e257564d><a class="VPLink link pager-link next" href="/myBlog/notes/frontend-basics/browser-storage.html" data-v-e257564d><!--[--><span class="desc" data-v-e257564d>Next page</span><span class="title" data-v-e257564d>浏览器存储知识</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-5d98c3a5 data-v-e315a0ad><div class="container" data-v-e315a0ad><!----><p class="copyright" data-v-e315a0ad>Copyright © 2026 QianAn</p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"index.md\":\"BpVJn3_p\",\"notes_deployment_analytics.md\":\"BJ_uKzM6\",\"notes_deployment_deployment-guide.md\":\"D6I01fQj\",\"notes_engineering_frontend-development-standards.md\":\"DwVuBBb9\",\"notes_engineering_frontend-engineering-guide.md\":\"Bw2-_BAc\",\"notes_engineering_git-commit-convention.md\":\"Bpl2ssg2\",\"notes_engineering_vue-webcomponent-build-issues.md\":\"B4qqMDBB\",\"notes_external-api_yuque-openapi-guide.md\":\"CyAvw8iN\",\"notes_frontend-basics_browser-storage.md\":\"CWI3jfHX\",\"notes_frontend-basics_coordinate-system-guide.md\":\"B1zDyquL\",\"notes_frontend-basics_css-style-guide.md\":\"DGyY2LpM\",\"notes_index.md\":\"CCIHiSrN\",\"notes_network_index.md\":\"RuaJwLFO\",\"notes_projects_3d-particle-interaction.md\":\"BbzJR37y\",\"notes_tools_claude_config-claude-json.md\":\"uE4h0gT8\",\"notes_tools_claude_dev-standards.md\":\"C6yd16SI\",\"notes_tools_claude_mcp-and-proxy.md\":\"CwexXgz8\",\"notes_tools_claude_setup.md\":\"1rIY9WNU\",\"notes_tools_claude_skills-guide.md\":\"CyxpW-N5\",\"notes_tools_cursor_cursor-rules.md\":\"C4dZzeB0\",\"notes_tools_qwen_qwen-code.md\":\"DNsu3lkZ\",\"projects_index.md\":\"Bar8ocuX\",\"resume_index.md\":\"Du39jTB6\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"zh-CN\",\"dir\":\"ltr\",\"title\":\"个人博客\",\"description\":\"学习笔记、技术分享、个人简历\",\"base\":\"/myBlog/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"logo\":\"/me.jpg\",\"nav\":[{\"text\":\"首页\",\"link\":\"/\"},{\"text\":\"学习笔记\",\"link\":\"/notes/\"},{\"text\":\"个人简历\",\"link\":\"/resume/\"},{\"text\":\"项目作品\",\"link\":\"/projects/\"}],\"sidebar\":{\"/notes/\":[{\"text\":\"学习笔记\",\"link\":\"/notes/\",\"items\":[{\"text\":\"前端基础\",\"items\":[{\"text\":\"CSS 规范文档\",\"link\":\"/notes/frontend-basics/css-style-guide\"},{\"text\":\"坐标系处理完整指南\",\"link\":\"/notes/frontend-basics/coordinate-system-guide\"},{\"text\":\"浏览器存储知识\",\"link\":\"/notes/frontend-basics/browser-storage\"}]},{\"text\":\"网络知识\",\"items\":[{\"text\":\"网络知识体系\",\"link\":\"/notes/network/\"}]},{\"text\":\"项目实战\",\"items\":[{\"text\":\"3D 粒子交互系统\",\"link\":\"/notes/projects/3d-particle-interaction\"}]},{\"text\":\"开发工具\",\"items\":[{\"text\":\"Cursor\",\"items\":[{\"text\":\"Cursor 开发规则\",\"link\":\"/notes/tools/cursor/cursor-rules\"}]},{\"text\":\"Claude Code\",\"items\":[{\"text\":\"安装与配置\",\"link\":\"/notes/tools/claude/setup\"},{\"text\":\"配置说明 (~/.claude.json)\",\"link\":\"/notes/tools/claude/config-claude-json\"},{\"text\":\"MCP 与代理\",\"link\":\"/notes/tools/claude/mcp-and-proxy\"},{\"text\":\"Skills 指南\",\"link\":\"/notes/tools/claude/skills-guide\"},{\"text\":\"开发规范\",\"link\":\"/notes/tools/claude/dev-standards\"}]},{\"text\":\"Qwen Code\",\"items\":[{\"text\":\"Qwen Code 安装\",\"link\":\"/notes/tools/qwen/qwen-code\"}]}]},{\"text\":\"网站部署\",\"items\":[{\"text\":\"GitHub Pages 部署\",\"link\":\"/notes/deployment/deployment-guide\"},{\"text\":\"网站访问统计配置\",\"link\":\"/notes/deployment/analytics\"}]},{\"text\":\"外部开发\",\"items\":[{\"text\":\"语雀 OpenAPI 开发指南\",\"link\":\"/notes/external-api/yuque-openapi-guide\"}]},{\"text\":\"工程化实践\",\"items\":[{\"text\":\"前端工程化实践指南\",\"link\":\"/notes/engineering/frontend-engineering-guide\"},{\"text\":\"前端开发规范\",\"link\":\"/notes/engineering/frontend-development-standards\"},{\"text\":\"Git 提交规范\",\"link\":\"/notes/engineering/git-commit-convention\"},{\"text\":\"Vue WebComponent 构建问题\",\"link\":\"/notes/engineering/vue-webcomponent-build-issues\"}]}]}]},\"socialLinks\":[{\"icon\":\"gitee\",\"link\":\"https://gitee.com/the-fields-are-dark\"}],\"footer\":{\"copyright\":\"Copyright © 2026 QianAn\"},\"search\":{\"provider\":\"local\"}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>